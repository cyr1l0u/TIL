# 반복형, 반복자, 제너레이터

> 데이터를 처리할 때 반복은 기본이다.

메모리에 다 들어가지 않는 데이터를 반복하기 위해서는 항목들을 느긋하게 가져와야 한다.

파이썬은 리스프와 달리 매크로가 없고, 반복자 패턴을 추상화할 수 있게 yield 키워드를 제공한다. 2011년 2.2버전에 추가되었으며, 제너레이터를 생성한다.

모든 제너레이터는 반복자이다. 제너레이터는 무한 수열을 표현할 수 있으나, 컬렉션에는 저장할 수는 없다. 이러한 차이에도 불구하고, 일반적으로 반복자와 제너레이터를 거의 동일시 한다.

## 단어 시퀀스

Sentence 클래스를 만들어서, 문장을 입력하면, 내부적으로 단어별로 저장하고, 이용함으로써 반복형에 대해서 살펴본다.

시퀀스는 반복할 수 있는데, 그 이유는 ```iter()```함수 때문이다.
1. 객체가 ```__iter__()``` 메서드를 구현하는지 확인하고, 구현되어 있으면 호출하여 반복자를 가져온다.
1. 구현되어 있지 않다면, ```__getitem__()```이 구현되었는 확인하며, 구현되어 있다면 인덱스가 0에서 시작하는 차례래로 반복하는 반복자를 생성한다.
1. 이 과정 모두가 실패하면 `TypeError`를 발생시킨다.

반복가능함을 확인하기 위해서는 `abc.Iterable`의 하부 클래스인지 확인해보면 되지만, 이 경우에는 ```__iter__()``` 메서드의 유무만 검사하므로, 저자는 `iter(x)`를 호출하고, `TypeError`를 처리하는 방식으로 확인하는 방법을 제안하고 있다.

**반복형**은 `iter()` 내장함수가 호출될 수 있는 모든 객체와 **반복자**를 반환하는 ```__iter__()``` 메서드를 구현한 객체이다.
**반복자**는 자료형이 아니라 프로토콜이며, 다음 항목을 반환하거나 항목이 없을 때 StopIteration 예외를 발생시키는 인수를 받지 않는 ```__next__()```메서드를 구현할 객체를 의미한다.
파이썬의 반복자는 ```__iter__```와 ```__next__``` 속성으로 갖고 있으며, 따라서 반복형이기도 하다.

## 고전적인 반복자

디자인 패턴에서 설명하는 반복자 디자인 패턴이다. 

앞서 만든 `Sentence` 클래스에서 반복형인 `SentenceIterator`를 돌려준다. 매우 간단하게 구현할 수 있는데, 잘못된 방법에 대해서 살펴보자.

`Sentence` 자체를 반복자로 만드는 것인데, 이는 반복형과 반복자를 구분하지 못하기 때문에 발생하는 문제이다.

반복자는 반복형이지만, 반복형은 반복자가 아니다.

디자인 패턴에서는 반복자 패턴은 다음과 같은 용도에 사용하도록 설명하고 있다.

* 집합 객체의 내부 표현을 노출시키지 않고 내용에 접근하는 경우
* 집합 객체의 다중 반복을 지원하는 경우
* 다양한 집합 구조체를 반복하기 위한 통일된 인터페이스를 제공하는 경우

즉, 다중 반복을 지원하기 위해서는 여러개의 독립적인 반복자를 가질 수 있어야 하며, 각 반복자는 고유한 내부 상태를 유지해야 한다.

